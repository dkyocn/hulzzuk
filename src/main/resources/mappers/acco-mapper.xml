<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
  "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="accoMapper">

  <!-- resultMap -->
  <resultMap type="location" id="resultList">
    <result property="locId" column="ACCO_ID"/>
    <result property="placeName" column="ACCO_PLACENAME"/>
    <result property="phone" column="ACCO_PHONE"/>
    <result property="addressName" column="ACCO_ADDRESSNAME"/>
    <result property="roadAddressName" column="ACCO_ROAD_ADDRESSNAME"/>
    <result property="x" column="ACCO_X"/>
    <result property="y" column="ACCO_Y"/>
    <result property="placeUrl" column="ACCO_RESER"/>
  </resultMap>
  
   <!-- 총 갯수 -->
  <select id="getAccoListCount" resultType="_int" parameterType="string">
    SELECT COUNT(*)
    FROM TB_ACCO
    <where>
      <if test="keyword != null and keyword != ''">
        (ACCO_PLACENAME LIKE '%' || #{keyword} || '%' OR ACCO_ROAD_ADDRESSNAME LIKE '%' || #{keyword} || '%')
      </if>
    </where>
  </select>
  
	<!-- 숙소 리스트 조회: keyword 검색 + 정렬 -->
  <select id="getAccoList" resultMap="resultList" parameterType="map">
    SELECT A.ACCO_PLACENAME, A.ACCO_ROAD_ADDRESSNAME
    FROM TB_ACCO A
    <where>
      <if test="keyword != null and keyword != ''">
        (ACCO_PLACENAME LIKE '%' || #{keyword} || '%' OR ACCO_ROAD_ADDRESSNAME LIKE '%' || #{keyword} || '%')
      </if>
    </where>
    <choose>
      <when test="sortEnum == 'LOVEDESC'">
        ORDER BY (SELECT COUNT(*) FROM TB_LOVE L WHERE L.ACCO_ID = A.ACCO_ID) DESC
      </when>
      <when test="sortEnum == 'REVIEWDESC'">
        ORDER BY (SELECT COUNT(*) FROM TB_REVIEW R WHERE R.ACCO_ID = A.ACCO_ID) DESC
      </when>
      <when test="sortEnum == 'NAMEDESC'">
        ORDER BY ACCO_PLACENAME DESC
      </when>
      <otherwise>
        ORDER BY ACCO_PLACENAME ASC
      </otherwise>
    </choose>
    WHERE RNUM BETWEEN 1 AND 10
  </select>

  <!-- 상세 조회 -->
  <select id="getAccoById" parameterType="string" resultMap="resultLocation">
    SELECT *
    FROM TB_ACCO
    WHERE ACCO_ID = #{accoId}
  </select>
  
</mapper>
	